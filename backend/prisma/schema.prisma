// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Facebook integration
  facebookId          String? @unique
  facebookAccessToken String?
  facebookTokenExpiry DateTime?

  // User accounts
  accounts Account[]
  sessions Session[]

  @@map("users")
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  facebookAccountId String
  accountName       String
  currency          String  @default("USD")
  timezone          String  @default("UTC")
  isActive          Boolean @default(true)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  user      User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  campaigns Campaign[]

  @@unique([userId, facebookAccountId])
  @@map("accounts")
}

model Session {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model Campaign {
  id                String   @id @default(cuid())
  accountId         String
  facebookCampaignId String
  name              String
  status            String
  objective         String?
  dailyBudget       Float?
  lifetimeBudget    Float?
  bidStrategy       String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  lastSyncAt        DateTime @default(now())

  account  Account          @relation(fields: [accountId], references: [id], onDelete: Cascade)
  insights CampaignInsight[]

  @@unique([accountId, facebookCampaignId])
  @@map("campaigns")
}

model CampaignInsight {
  id         String   @id @default(cuid())
  campaignId String
  date       DateTime
  
  // Core metrics
  impressions Int      @default(0)
  clicks      Int      @default(0)
  spend       Float    @default(0)
  ctr         Float    @default(0)
  cpc         Float    @default(0)
  cpm         Float    @default(0)
  
  // Conversions
  conversions     Int   @default(0)
  conversionRate  Float @default(0)
  costPerConversion Float @default(0)
  
  // Additional metrics
  reach           Int?
  frequency       Float?
  videoViews      Int?
  linkClicks      Int?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  campaign Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)

  @@unique([campaignId, date])
  @@map("campaign_insights")
}

model CacheEntry {
  id        String   @id @default(cuid())
  key       String   @unique
  value     String   // JSON as string for SQLite compatibility
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@map("cache_entries")
}